<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Media Upload ðŸ”¥</title>
<style>
  * { box-sizing: border-box; font-family: Arial, sans-serif; }
  body {
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background: #121212;
    color: #fff;
  }
  .container {
    background:#1e1e1e;
    padding:30px;
    border-radius:12px;
    width: 90%;
    max-width: 400px;
    text-align:center;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
  }
  h1 { margin-bottom:20px; font-size:22px; }
  #drop-area {
    border: 2px dashed #555;
    padding: 40px;
    border-radius:10px;
    cursor:pointer;
    transition: border-color 0.3s, background 0.3s;
  }
  #drop-area.hover { border-color: #ff4d4d; background: #2a2a2a; }
  #fileElem { display:none; }
  button {
    margin-top:15px;
    padding:10px 20px;
    border:none;
    border-radius:8px;
    background:#ff4d4d;
    color:#fff;
    cursor:pointer;
    font-size:16px;
    transition: background 0.3s;
  }
  button:hover { background:#ff6666; }
  #progress-container {
    margin-top:15px;
    height:10px;
    background:#333;
    border-radius:5px;
    overflow:hidden;
    display:none;
  }
  #progress-bar {
    height:10px;
    width:0%;
    background:#ff4d4d;
    transition: width 0.2s;
  }
  #progress-text {
    margin-top:5px;
    font-size:14px;
  }
  #link {
    margin-top:20px;
    word-break:break-all;
    color:#00ff99;
  }
  #link button {
    background:#00ff99;
    color:#000;
    margin-left:10px;
    padding:5px 10px;
    font-size:14px;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Secure Media Upload ðŸ”¥</h1>
  <div id="drop-area">
    Drag & Drop your file here <br>or<br>
    <button id="browseBtn">Browse</button>
    <input type="file" id="fileElem">
  </div>

  <div id="progress-container">
    <div id="progress-bar"></div>
    <div id="progress-text"></div>
  </div>

  <div id="link"></div>
</div>

<script>
  const dropArea = document.getElementById('drop-area');
  const fileElem = document.getElementById('fileElem');
  const browseBtn = document.getElementById('browseBtn');
  const progressContainer = document.getElementById('progress-container');
  const progressBar = document.getElementById('progress-bar');
  const progressText = document.getElementById('progress-text');
  const linkDiv = document.getElementById('link');

  browseBtn.addEventListener('click', () => fileElem.click());

  fileElem.addEventListener('change', e => handleFiles(e.target.files));
  dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.classList.add('hover'); });
  dropArea.addEventListener('dragleave', e => { e.preventDefault(); dropArea.classList.remove('hover'); });
  dropArea.addEventListener('drop', e => { e.preventDefault(); dropArea.classList.remove('hover'); handleFiles(e.dataTransfer.files); });

  function handleFiles(files) {
    if(files.length === 0) return;
    uploadFile(files[0]);
  }

  function uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);

    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';
    progressText.innerText = '';
    linkDiv.innerHTML = '';

    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/upload');

    xhr.upload.addEventListener('progress', e => {
      if(e.lengthComputable){
        const percent = ((e.loaded / e.total) * 100).toFixed(0);
        progressBar.style.width = percent + '%';
        progressText.innerText = percent + '% uploaded';
      }
    });

    xhr.onload = () => {
      if(xhr.status === 200){
        const res = JSON.parse(xhr.responseText);
        linkDiv.innerHTML = `
          <strong>Link:</strong> <a href="${res.link}" target="_blank">${res.link}</a>
          <button onclick="copyLink('${res.link}')">Copy</button>
        `;
      } else {
        linkDiv.innerHTML = `<span style="color:red;">Upload failed: ${xhr.statusText}</span>`;
      }
      progressContainer.style.display = 'none';
    };

    xhr.onerror = () => {
      linkDiv.innerHTML = `<span style="color:red;">Upload failed due to network error.</span>`;
      progressContainer.style.display = 'none';
    };

    xhr.send(formData);
  }

  function copyLink(url) {
    navigator.clipboard.writeText(url)
      .then(() => alert('Link copied to clipboard!'))
      .catch(() => alert('Failed to copy link.'));
  }
</script>

</body>
</html>
